<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</title>
<style>
body { font-family: "Segoe UI", sans-serif; background: linear-gradient(135deg,#1a1a1a,#333); display:flex; justify-content:center; align-items:center; height:100vh; margin:0; color:#fff; }
.card { background: rgba(255,255,255,0.05); padding:2rem 3rem; border-radius:12px; text-align:center; max-width:400px; }
input { width:100%; padding:0.6rem; margin:0.5rem 0; border:none; border-radius:6px; }
button { width:100%; padding:0.7rem; border:none; border-radius:6px; background:#ff6b6b; color:white; cursor:pointer; font-size:1rem; }
button:hover { background:#ff4c4c; }
#msg { margin-top:1rem; color:#ff6b6b; font-weight:bold; }
</style>
</head>
<body>
<div class="card">
<h2>üîí –í—Ö–æ–¥</h2>
<input type="text" id="username" placeholder="–õ–æ–≥–∏–Ω" required>
<input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
<button onclick="login()">–í–æ–π—Ç–∏</button>
<p id="msg"></p>
</div>

<script>
let server_ip = "";

async function getServerIP() {
    try {
        const res = await fetch("https://api.ipify.org?format=json");
        const data = await res.json();
        server_ip = data.ip;
    } catch (e) {
        console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å IP —Å–µ—Ä–≤–µ—Ä–∞:", e);
        server_ip = window.location.hostname; // fallback
    }
}

async function login() {
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const subdomain = window.location.hostname.split('.')[0];

    if (!server_ip) await getServerIP();

    const res = await fetch(`http://${server_ip}:8000/api/host/check`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ subdomain, username, password })
    });

    const msg = document.getElementById('msg');

    if(res.status === 200){
        document.cookie = `Auth_${subdomain}=OK; path=/; samesite=strict`;
        window.location.href = '/';
    } else if(res.status === 401 || res.status === 403){
        msg.innerText = "–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å!";
    } else if(res.status === 502){
        msg.innerText = "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä, –≤–æ–∑–º–æ–∂–Ω–æ, –Ω–µ –∑–∞–ø—É—â–µ–Ω. –°–≤—è–∂–∏—Ç–µ—Å—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.";
    } else {
        msg.innerText = "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.";
    }
}
</script>
</body>
</html>
